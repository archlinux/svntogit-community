# Contributor: Heeru Kiyura <M8R-p9i5nh@mailinator.com>
# Maintainer: Stefan Husmann <stefan-husmann@t-online.de>

_commit=0d883dfd5e61e7d0b8a96a079d69b46af064fdca
pkgname=conkeror-git
pkgver=0.9.3
pkgrel=5
pkgdesc="A highly programmable web browser based on Mozilla XULRunner."
arch=('i686' 'x86_64')
url="http://conkeror.mozdev.org/"
license=('MPL' 'GPL' 'LGPL')
depends=('xulrunner' 'desktop-file-utils')
makedepends=('git' 'imagemagick')
provides=(conkeror)
source=(conkeror_gimpfile.xpm)
md5sums=('b592582a5b923db1707615564a95737f')
install=conkeror-git.install

__gitroot="git://repo.or.cz/conkeror.git"
__gitname="conkeror"

build() {
  cd $srcdir

 ## Git checkout
  if [ -d $srcdir/${__gitname} ] ; then
    msg "Git checkout:  Updating existing tree"
    cd ${__gitname} && git checkout ${_commit}
    msg "Git checkout:  Tree has been updated"
  else
    msg "Git checkout:  Retrieving sources"
    git clone ${__gitroot} && cd ${__gitname} && git checkout ${_commit} 
  fi
  msg "Checkout completed"

 ## Build
  [ -d ${__gitname}-build ] || rm -rf $srcdir/${__gitname}-build
  git clone $srcdir/${__gitname} $srcdir/${__gitname}-build
  cd $srcdir/${__gitname}-build
  make 
}

package() { 
  cd $srcdir/${__gitname}-build
  install -d $pkgdir/usr/share/conkeror
  install -Dm755 $srcdir/${__gitname}-build/conkeror-spawn-helper \
    $pkgdir/usr/bin/conkeror-spawn-helper
  install -d $pkgdir/usr/share/man/man1
  cp -a $srcdir/${__gitname}-build/* $pkgdir/usr/share/conkeror 
  install -Dm644 $pkgdir/usr/share/conkeror/contrib/man/conkeror.1 \
    $pkgdir/usr/share/man/man1/conkeror.1
  rm -r $pkgdir/usr/share/conkeror/contrib/man
  install -Dm644 $srcdir/${__gitname}-build/debian/conkeror.desktop \
    $pkgdir/usr/share/applications/conkeror.desktop
  ln -s /usr/share/conkeror/contrib/run-conkeror \
    $pkgdir/usr/bin/conkeror 
  rm $pkgdir/usr/share/conkeror/conkeror-spawn-helper
  rm -r $pkgdir/usr/share/conkeror/debian
  install -d $pkgdir/usr/share/pixmaps
  install $srcdir/conkeror_gimpfile.xpm $pkgdir/usr/share/pixmaps
} 
