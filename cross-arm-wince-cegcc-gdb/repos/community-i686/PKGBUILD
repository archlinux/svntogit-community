# $Id: PKGBUILD,v 1.6 2009/04/09 09:51:51 sergej Exp $
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=cross-arm-wince-cegcc-gdb
pkgver=0.51.0
pkgrel=1
pkgdesc="CE GCC bundle - cross compilation tools for WinCE"
arch=(i686 x86_64)
license=(GPL)
options=(!libtool)
url="http://cegcc.sf.net"
depends=('glibc')
groups=('cegcc')
source=(http://st-kuznetsy.ru/sergej/cegcc-$pkgver-src.tar.bz2)
md5sums=('0ed59367a01d0baa04cc941e4bf1c2d1')

_prefix=/opt/cegcc

build() {
  cd ${startdir}/src/cegcc/src/

  export PATH=$_prefix/bin:$PATH
  export TARGET=arm-wince-cegcc
  unset CFLAGS
  unset CXXFLAGS
  unset LDFLAGS
  unset MAKEFLAGS

  mkdir -p gdb-build && \
  cd gdb-build || return 1

  PREV_CFLAGS=${CFLAGS}
  export CFLAGS="-I${_prefix}/arm-wince-cegcc/include/w32api/"

  ../gdb/configure  \
	--with-gcc                     \
	--with-gnu-ld                  \
	--with-gnu-as                  \
	--target=arm-wince-cegcc       \
	--prefix=${_prefix}            \
	--disable-nls                  \
	--disable-win32-registry       \
	--disable-multilib             \
	--disable-interwork            \
	--enable-checking

  export CFLAGS=${PREV_CFLAGS}

#  make || (cd gdb/doc && make) && make || return 1
  make || return 1

  (cd etc && make DESTDIR=$startdir/pkg install)
  (cd gdb/doc && make DESTDIR=$startdir/pkg install)
  make DESTDIR=$startdir/pkg install || return 1

  rm -f $startdir/pkg/opt/cegcc/info/configure.info \
	$startdir/pkg/opt/cegcc/info/dir \
	$startdir/pkg/opt/cegcc/info/standards.info
}
