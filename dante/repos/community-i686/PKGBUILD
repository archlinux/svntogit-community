# Contributor: Guillem Rieu <guillemr@gmx.net>

pkgname=dante
pkgver=1.2.0
pkgrel=3
pkgdesc="SOCKS v4 and v5 compatible proxy server and client"
url="http://www.inet.no/dante"
arch=(i686 x86_64)
license=('custom')
depends=()
backup=('etc/socks.conf' 'etc/sockd.conf')
source=(ftp://ftp.inet.no/pub/socks/$pkgname-$pkgver.tar.gz
	sockd.rc
	dante-upnpcleanup.patch)
options=(!libtool)
md5sums=('af00063243cc94e524497342982615cd'
         '5110dfd78a2b38fff27a886ee88b58a6'
	 '92d197edb872823071e3656cc296d662')

build() {
  cd $srcdir/$pkgname-$pkgver
  patch lib/upnp.c $srcdir/dante-upnpcleanup.patch
  [ $NOEXTRACT -eq 1 ] || ./configure --prefix=/usr --sysconfdir=/etc
  make || return 1
  make DESTDIR=$pkgdir install || return 1

  # Config files
  mkdir -p $pkgdir/etc/conf.d
  cp example/{socks,sockd}.conf $pkgdir/etc || return 1

  # License
  install -D -m644 LICENSE $pkgdir/usr/share/licenses/$pkgname/LICENSE || return 1

  # rc-script
  install -D -m755 $srcdir/sockd.rc $pkgdir/etc/rc.d/sockd || return 1
  echo 'SOCKD_OPTS="-D"' >$pkgdir/etc/conf.d/sockd.conf
}
