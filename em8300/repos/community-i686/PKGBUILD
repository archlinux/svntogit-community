# $Id$
# Contributor: Jaroslaw Swierczynski <swiergot@juvepoland.com>

pkgname=em8300
pkgver=0.18.0
_kernver=2.6.31-ARCH
pkgrel=1
pkgdesc="DXR3 and Hollywood+ driver"
arch=('i686' 'x86_64')
url="http://dxr3.sourceforge.net/"
license=('GPL2')
depends=('kernel26>=2.6.31' 'kernel26<2.6.32' "em8300-utils=$pkgver")
install=em8300.install
source=(http://downloads.sourceforge.net/project/dxr3/em8300/${pkgver}/em8300-${pkgver}.tar.gz)
md5sums=('2ef10f5159508a31a877e7e6d18c6896')

build() {
  cd $srcdir/$pkgname-$pkgver/modules

  sed -i "s!^KERNEL_LOCATION := .*\$!KERNEL_LOCATION := /lib/modules/${_kernver}/build!" Makefile

  make || return 1
  make DESTDIR=$pkgdir install || return 1

  chmod 644 $pkgdir/lib/modules/*/em8300/*.ko
  sed -i -e "s/KERNEL_VERSION='.*'/KERNEL_VERSION='${_kernver}'/" $startdir/*.install
}
