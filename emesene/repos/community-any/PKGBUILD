# $Id$
# Maintainer: Ronald van Haren <ronald.archlinux.org>
# Contributor: Claudio Riva <firetux83@gmail.com>

pkgname=emesene
pkgver=2.12.1
pkgrel=1
pkgdesc="A pygtk MSN Messenger client"
url="http://www.emesene.org/"
license=('GPL' 'GPL3' 'LGPL3')
arch=('any') 
depends=('python2' 'pygtk' 'python-dnspython' 'pylint' 'python-notify' 'openssl' \
'python-imaging' 'dbus-python' 'xdg-utils' 'hicolor-icon-theme' \
'gstreamer0.10-python' 'gstreamer0.10-good' 'pycrypto' \
'python2-gobject2' 'python2-pyopenssl' 'pywebkitgtk')
makedepends=('python2-distribute')
optdepends=('gnome-python-extras: spell-check plugin'
	'gtkspell: spell-check plugin'
	'farsight2: webcam support'
        'xmpppy: for gtalk and facebook chat support'
	'pyqt: alternative qt4 interface (emesene -e main:qt4_main')
source=("${pkgname}-${pkgver}.tar.gz::https://github.com/emesene/emesene/tarball/v2.12.1"
        'emesene.run')
install=emesene.install
options=('!libtool')
sha1sums=('0ffc514b2d6942ec1fc5604d15cba5e1602bf5f8'
          '2bd13ada86aa0af6307a41047f0d7caf2995660d')

build() {
  cd ${srcdir}/${pkgname}-${pkgname}-2f7b7f5

  # do not import dummy session
  # sed -i -e  "/import dummy/d" emesene/emesene.py

  # install files
  export PYTHONPATH="${pkgdir}/usr/lib/python2.7/site-packages/"
  install -d ${pkgdir}/usr/lib/python2.7/site-packages/
  python2 setup.py install --prefix=${pkgdir}/usr
}

package() {
  cd ${pkgdir}

  # use /usr/share/emesene instead of /usr/lib/python2.5/site-packages
  mv -f ${pkgdir}/usr/lib/python2.7/site-packages/emesene-${pkgver}-py2.7.egg/share \
        ${pkgdir}/usr
  mv -f ${pkgdir}/usr/lib/python2.7/site-packages/emesene-${pkgver}-py2.7.egg/emesene \
        ${pkgdir}/usr/share
  rm -rf ${pkgdir}/usr/lib

  # python -> python2 
  find -name *.py -exec sed -i "s|/usr/bin/env python|/usr/bin/env python2|" {} \;
  sed -i "s|/usr/bin/env python|/usr/bin/env python2|" ${pkgdir}/usr/share/emesene/emesene

  # create executable
  install -Dm755 ${srcdir}/emesene.run ${pkgdir}/usr/bin/emesene
}
