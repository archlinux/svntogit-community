# $Id$
# Maintainer: Felix Yan <felixonmars@gmail.com>
# Contributor: cuihao <cuihao dot leo at gmail dot com>
# Contributor: Guten <ywzhaifei@gmail.com> 

pkgname=goagent
pkgver=3.0.2
pkgrel=1
pkgdesc="A gae proxy forked from gappproxy/wallproxy"
arch=("any")
url="http://goagent.googlecode.com"
license=("GPL2")
depends=('python' 'python-pyopenssl')
optdepends=('python2: if you want to use uploader.zip to upload server')
source=(https://github.com/goagent/goagent/archive/v$pkgver.tar.gz
        $pkgname.service)
backup=('etc/goagent')
install=goagent.install

package() {
  cd "$srcdir/$pkgbase-$pkgver"
  
  install -Dm755 local/proxy.py "$pkgdir/usr/share/$pkgname/local/proxy.py"
  install -Dm644 local/proxy.pac "$pkgdir/usr/share/$pkgname/local/proxy.pac"
  install -Dm644 local/cacert.pem "$pkgdir/usr/share/$pkgname/local/cacert.pem"
  install -Dm644 local/SwitchyOptions.bak "$pkgdir/usr/share/$pkgname/local/SwitchyOptions.bak"
  install -Dm644 local/SwitchySharp_1_9_52.crx "$pkgdir/usr/share/$pkgname/local/SwitchySharp_1_9_52.crx"

  install -Dm644 local/proxy.ini "$pkgdir/etc/goagent"
  ln -sf "/etc/goagent" "${pkgdir}/usr/share/$pkgname/local/proxy.ini"
  
  cp -r server "$pkgdir/usr/share/$pkgname/"
  rm "$pkgdir/usr/share/$pkgname/server/uploader.bat"

  # systemd service
  install -Dm644 "${srcdir}/goagent.service" "${pkgdir}/usr/lib/systemd/system/goagent.service"
}

# vim:set ts=2 sw=2 et:
md5sums=('aa3e3466a47ca62a86f733c11decd822'
         '97942151b98573b150a0c6e4f664aa95')
