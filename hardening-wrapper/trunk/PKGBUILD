# $Id$
# Maintainer: Daniel Micay <danielmicay@gmail.com>
pkgname=hardening-wrapper
pkgver=7
pkgrel=1
pkgdesc='Wrapper scripts for building hardened executables by default'
arch=(i686 x86_64)
url='https://archlinux.org/'
license=('GPL')
depends=(bash)
backup=(etc/hardening-wrapper.conf)
source=(cc-wrapper.sh ld-wrapper.sh common.sh path.sh
        hardening-wrapper-i686.conf hardening-wrapper-x86_64.conf)
sha1sums=('683aefa825cdc070262e7e605e8b33907e92cd2a'
          'e8c1fc067c15631fee3ba6282b1c2aa90f25c12b'
          '517afb3bd75a9f9e13aedb19079d26cd76d52bd2'
          '1e5f6d9931f01b26bb4b6fbb839e21d34d534cdc'
          '4d7a8f4818c531ce7002e860e0654b42b6147037'
          '50db33c08439393b673c23d542e274beef44fbdd')

package() {
  install -Dm644 hardening-wrapper-${CARCH}.conf "$pkgdir/etc/hardening-wrapper.conf"
  install -Dm644 path.sh "$pkgdir/etc/profile.d/hardening-wrapper.sh"

  base="$pkgdir/usr/lib/hardening-wrapper"

  mkdir -p "$base/bin"
  install -m755 {cc,ld}-wrapper.sh "$base"
  install -m644 common.sh "$base"

  ln "$base/cc-wrapper.sh" "$base/bin/c89"
  ln "$base/cc-wrapper.sh" "$base/bin/c99"
  ln "$base/cc-wrapper.sh" "$base/bin/cc"
  ln "$base/cc-wrapper.sh" "$base/bin/c++"
  ln "$base/cc-wrapper.sh" "$base/bin/clang"
  ln "$base/cc-wrapper.sh" "$base/bin/clang++"
  ln "$base/cc-wrapper.sh" "$base/bin/gcc"
  ln "$base/cc-wrapper.sh" "$base/bin/g++"

  ln "$base/ld-wrapper.sh" "$base/bin/ld"
  ln "$base/ld-wrapper.sh" "$base/bin/ld.bfd"
  ln "$base/ld-wrapper.sh" "$base/bin/ld.gold"
}
