# $Id$
# Contributor: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>
# Contributor: Angel Velasquez <angvp@archlinux.org>
# Contributor: Juergen Hoetzel <juergen@archlinux.org>

pkgname=lxsession
pkgver=0.5.1
pkgrel=1
epoch=1
pkgdesc='Lightweight X11 session manager'
arch=('i686' 'x86_64')
url="http://lxde.org/"
license=('GPL2')
groups=('lxde')
depends=('gtk2' 'dbus-glib' 'polkit')
makedepends=('intltool' 'docbook-xsl' 'vala')
replaces=('lxpolkit' 'lxsession-lite' 'lxde-settings-daemon')
conflicts=('lxpolkit' 'lxsession-lite' 'lxde-settings-daemon')
source=(http://downloads.sourceforge.net/lxde/$pkgname-$pkgver.tar.xz
        fix-lxsession-db.patch)
md5sums=('39bf77d637fbe40318f91d0d888127fc'
         'b6508ab44282f56c91d89a8c2c245438')

prepare() {
  cd $pkgname-$pkgver

  # lxsession-db: Don't hang when MIME folders are not available.
  # https://sourceforge.net/p/lxde/patches/479/
  patch -Np1 -i ../fix-lxsession-db.patch
}

build() {
  cd $pkgname-$pkgver
  ./configure --sysconfdir=/etc --prefix=/usr
  make
}

package() {
  cd $pkgname-$pkgver
  make DESTDIR="$pkgdir" install 

  # Remove lxpolkit autostart file as we already launch it by lxsession
  rm -r "$pkgdir/etc"
}
