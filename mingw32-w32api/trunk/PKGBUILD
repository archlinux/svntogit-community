# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Maintainer: Ondrej Jirman <megous@megous.com>

pkgname=mingw32-w32api
pkgver=3.16
_runtimever=3.18
pkgrel=1
arch=('any')
pkgdesc="Windows header files for mingw32 C cross-compiler"
makedepends=(mingw32-gcc-base)
options=(!strip)
license=(LGPL)
url="http://www.mingw.org/"
source=(http://downloads.sourceforge.net/project/mingw/MinGW/BaseSystem/RuntimeLibrary/Win32-API/w32api-$pkgver/w32api-$pkgver-1-mingw32-src.tar.lzma
	http://downloads.sourceforge.net/mingw/mingwrt-${_runtimever}-mingw32-src.tar.gz)
md5sums=('d9ca3759d8dc0d1c93aeea81f730fde5'
         '34b54cb3379f871f0dcd5c20b69b0350')

build()
{
  cd $srcdir
  [ $NOEXTRACT -eq 1 ] || tar --lzma -xf w32api-$pkgver-1-mingw32-src.tar.lzma
  cd $srcdir/w32api-$pkgver-1-mingw32

  mkdir -p $srcdir/include/
  cp -r $srcdir/mingwrt-${_runtimever}-mingw32/include/* $srcdir/include/
  export CFLAGS="-mms-bitfields -I$srcdir/include -I$srcdir/w32api-$pkgver-mingw32/include"

  ./configure --prefix=/usr/i486-mingw32 --target=i486-mingw32 --host=i486-mingw32 --build=$CHOST
  make
  make install prefix=$pkgdir/usr/i486-mingw32

  cd $pkgdir
  find . -name '*.a' | xargs -rtl1 i486-mingw32-strip -g
}
