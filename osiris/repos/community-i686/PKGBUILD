# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: jlvsimoes

pkgname=osiris
pkgver=4.2.3
pkgrel=3
pkgdesc="A file integrity management system"
arch=('i686' 'x86_64')
url="http://osiris.shmoo.com/"
license=('custom')
depends=('openssl' 'readline')
install=$pkgname.install
#source=(http://osiris.shmoo.com/data/osiris-$pkgver.tar.gz
source=(http://arch.p5n.pp.ru/~sergej/dl/2011/osiris-$pkgver.tar.gz
	osirismd.init
	osirisd.init)
md5sums=('1951c7dc0fe729af9ffaf58910340d12'
         '44281b8fc30ab3d452c6f35d3539d7ff'
         'b859445803e4df59a4f82d7f411e1297')

build() {
  cd $srcdir/$pkgname-$pkgver
  mkdir -p $pkgdir/usr/share/licenses/$pkgname/
  install -m644 LICENSE $pkgdir/usr/share/licenses/$pkgname/license.txt
  mkdir -p $pkgdir/etc/rc.d

  ./configure --prefix=/usr --enable-fancy-cli  --with-md-root-dir=/usr/share/$pkgname
  make all

  # Arch-ify install locations
  sed -i "s|^INSTALL_OSIRISM=0|INSTALL_OSIRISM=1|" src/install/install.sh
  sed -i "s|^INSTALL_OSIRISD=0|INSTALL_OSIRISD=1|" src/install/install.sh
  sed -i "s|^ROOT_GROUP=wheel|ROOT_GROUP=root|" src/install/install.sh

  make DESTDIR=$pkgdir install

  install -D -m755 $srcdir/osirismd.init $pkgdir/etc/rc.d/osirismd
  install -D -m755 $srcdir/osirisd.init $pkgdir/etc/rc.d/osirisd
  rm -rf $pkgdir/usr/osiris
}
