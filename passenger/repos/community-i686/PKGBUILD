# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=passenger
pkgver=3.0.11
pkgrel=1
_pkgdlnr=75548
pkgdesc="mod_rails passenger"
arch=('i686' 'x86_64')
url="http://www.modrails.com"
license=('GPL')
depends=('apache' 'ruby' 'ruby-rack' 'curl')
install=$pkgname.install
options=('!emptydirs')
source=(http://rubyforge.org/frs/download.php/${_pkgdlnr}/$pkgname-$pkgver.tar.gz
	$pkgname-install-apache2-module.patch)
md5sums=('9186d799e065ccad803cbc0289954f40'
         '3d04eba10c55a955c378678d5df8497f')

build(){
  cd $srcdir/$pkgname-$pkgver
  patch bin/passenger-install-apache2-module <$srcdir/passenger-install-apache2-module.patch
  ./bin/passenger-install-apache2-module
  mkdir -p $pkgdir/etc/httpd/modules/
  cp ext/apache2/mod_passenger.so $pkgdir/etc/httpd/modules/mod_passenger.so
  mkdir -p $pkgdir/usr/lib/passenger/
  cp -R * $pkgdir/usr/lib/passenger/
  mkdir -p $pkgdir/usr/lib/httpd
  mv $pkgdir/etc/httpd/modules $pkgdir/usr/lib/httpd/modules
}
