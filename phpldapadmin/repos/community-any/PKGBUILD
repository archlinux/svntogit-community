# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>

pkgname=phpldapadmin
pkgver=1.2.2
pkgrel=1
pkgdesc="A PHP and hence web-based tool to administrate LDAP over the WWW"
arch=('any')
url="http://phpldapadmin.sourceforge.net/"
license=('GPL')
depends=('libldap' 'php' 'php-ldap')
backup=("etc/webapps/phpldapadmin/.htaccess"
	"etc/webapps/phpldapadmin/config.php")
source=(http://downloads.sourceforge.net/project/phpldapadmin/phpldapadmin-php5/$pkgver/phpldapadmin-$pkgver.tgz)
md5sums=('78ca61eb5d7913963f8e42eb3b4f0e95')

build() {
  _instdir=$pkgdir/usr/share/webapps/phpldapadmin
  mkdir -p ${_instdir} $pkgdir/etc/webapps/phpldapadmin
  cd ${_instdir}

  cp -ra $srcdir/phpldapadmin-${pkgver}/* .
  echo "deny from all" >$pkgdir/etc/webapps/phpldapadmin/.htaccess

  ln -s /etc/webapps/phpldapadmin/.htaccess ${_instdir}/.htaccess
  ln -s /etc/webapps/phpldapadmin/config.php ${_instdir}/config/config.php
  cp ${_instdir}/config/config.php.example $pkgdir/etc/webapps/phpldapadmin/config.php

  cat >$pkgdir/etc/webapps/phpldapadmin/apache.example.conf <<EOF
	Alias /phpldapadmin "/usr/share/webapps/phpldapAdmin"
	<Directory "/usr/share/webapps/phpldapAdmin">
		AllowOverride All
		Options FollowSymlinks
		Order allow,deny
		Allow from all
		php_admin_value open_basedir "/srv/:/tmp/:/usr/share/webapps/:/etc/webapps:/usr/share/pear/"
	</Directory>
EOF
}
