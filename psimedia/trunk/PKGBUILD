# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Vladimir Kutyavin <vlkut-at-bk-dot-ru>

pkgname=psimedia
pkgver=1.0.3
pkgrel=9
pkgdesc="Voice and video chat plugin for Psi-like IM clients.  The implementation is based on GStreamer."
arch=('i686' 'x86_64')
license=('GPL2')
url="http://delta.affinix.com/psimedia/"
depends=('psi' 'speex' 'gstreamer0.10-base' 'qt4' 'gstreamer0.10-good-plugins'
	 'liboil')
makedepends=('pkgconfig')
source=(http://delta.affinix.com/download/psimedia/$pkgname-$pkgver.tar.bz2
	videodev.h
	psimedia-svn20110621.diff.gz)
md5sums=('1be71c37d71c655ffc2c53cf86c77a7a'
         '427e5832466726a86e5b55b1329d2e9e'
         'b571639d854c90c758f40a44054c6e06')

build() {
  cd $srcdir/$pkgname-$pkgver
  patch -p1 <$srcdir/psimedia-svn20110621.diff
  sed -i 's|# include <linux/videodev.h>|# include "../../../videodev.h"|' gstprovider/deviceenum/deviceenum_unix.cpp
  ./configure
  make
}

package() {
  cd $srcdir/$pkgname-$pkgver
  install -D -m644 ${srcdir}/$pkgname-$pkgver/gstprovider/libgstprovider.so ${pkgdir}/usr/lib/psi/plugins/libgstprovider.so
}
