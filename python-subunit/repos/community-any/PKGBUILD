# Maintainer: Felix Yan <felixonmars@archlinux.org>

pkgname=python-subunit
pkgver=1.3.0
pkgrel=5
pkgdesc="Python implementation of subunit test streaming protocol"
arch=('any')
license=('Apache')
url="https://launchpad.net/subunit"
depends=('python-extras' 'python-testtools')
makedepends=('python-setuptools')
checkdepends=('python-fixtures' 'python-hypothesis' 'python-testscenarios')
source=("https://pypi.io/packages/source/p/python-subunit/python-subunit-$pkgver.tar.gz")
sha512sums=('387c9ce8ed679d8998d33c7a295412e4f9de46b8dccdfab92eb82d8c4290958760b6c9bd99d50abd0836e4556c1b0c0132fc01e16801a3113844ab1bf28cf962')

prepare() {
  sed -i 's|import unittest2 as unittest|import unittest|' python-subunit-$pkgver/python/subunit/tests/test_test_protocol.py
}

build() {
  cd python-subunit-$pkgver
  python setup.py build
}

check() {
  cd python-subunit-$pkgver
  PYTHONPATH="$PWD/build/lib:$PYTHONPATH" python -m testtools.run subunit.test_suite || :
}

package() {
  cd python-subunit-$pkgver
  python setup.py install --root="${pkgdir}" --optimize=1
}
