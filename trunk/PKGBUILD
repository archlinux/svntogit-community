# Maintainer: Thomas S Hatch <thatch45@gmail.com>
# Contributor: Corrado 'bardo' Primier <corrado.primier@mail.polimi.it>
# Contributor: Jochem Kossen <j.kossen@home.nl>
# Contributor: Daniel J Griffiths <ghost1227@archlinux.us>

pkgname=scite
pkgver=2.27
pkgrel=1
pkgdesc='A generally useful editor with facilities for building and running programs.'
arch=('i686' 'x86_64')
url='http://www.scintilla.org/SciTE.html'
license=('custom:scite')
depends=('desktop-file-utils' 'gtk2')
backup=(usr/share/scite/SciTEGlobal.properties)
install=scite.install
source=("http://downloads.sourceforge.net/sourceforge/scintilla/${pkgname}${pkgver/\./}.tgz"
        'SciTE.desktop'
        'makefile.patch')
md5sums=('ac5aafa1b47da3792a56d5fd9f383fda'
         '48526532ef677982a4b156ae90f25b6f'
         '87005d4c7262a1a698cde0628dc7e2a2')

build() {
  sed "s/CXXTFLAGS=-DNDEBUG -Os $(CXXBASEFLAGS)/CXXTFLAGS=-DNDEBUG ${CXXFLAGS} $(CXXBASEFLAGS)/" -i scite/gtk/makefile

  sed "s/CXXBASEFLAGS=-Wall -Wno-missing-braces -Wno-char-subscripts -pedantic -DGTK -DSCI_LEXER \$(INCLUDEDIRS)/CXXBASEFLAGS=-Wall -Wno-missing-braces -Wno-char-subscripts -pedantic ${CXXFLAGS} -DGTK -DSCI_LEXER \$(INCLUDEDIRS)/" -i scintilla/gtk/makefile

  sed "s/CXXFLAGS=-DNDEBUG -Os \$(CXXBASEFLAGS) \$(THREADFLAGS)/CXXFLAGS=-DNDEBUG ${CXXFLAGS} \$(CXXBASEFLAGS) \$(THREADFLAGS)/" -i scintilla/gtk/makefile

  cd scintilla/gtk
  make
  install -Dm644 ../License.txt \
    ${pkgdir}/usr/share/licenses/scintilla/LICENSE

  cd ${srcdir}/${pkgname}/gtk
  make

  make DESTDIR=${pkgdir} install

  install -D -m644 ../License.txt \
    ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE

  install -D -m644 ${srcdir}/SciTE.desktop \
    ${pkgdir}/usr/share/applications/

  ln -sf SciTE ${pkgdir}/usr/bin/scite
}
