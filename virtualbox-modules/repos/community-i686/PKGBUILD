# Maintainer: Geoffroy Carrier <geoffroy.carrier@aur.archlinux.org>
# Contributor: Andrea Scarpino <bash.lnx@gmail.com>
# Contributor: Roman Kyrylych <roman@archlinux.org>
# Contributor: Michal Krenek <mikos@sg1.cz>
# Contributor: niQo
# Contributor: Ingmar Steen 
 
pkgname=virtualbox-modules
_kernver=2.6.30-ARCH
pkgver=3.0.2
pkgrel=1
pkgdesc="Kernel modules for VirtualBox (vboxdrv)"
arch=('i686')
url="http://www.virtualbox.org"
license=('GPL')
depends=('kernel26>=2.6.30' 'kernel26<2.6.31')
makedepends=('bin86' 'dev86' 'iasl' 'libstdc++5' 'qt' 'sdl_ttf' 'libxt' 'libxmu' 'libxtst'
             'libgl' 'alsa-lib' 'pulseaudio' 'libxcursor' 'libidl2' 'libxslt'
             'xalan-c' 'pth' 'libxml2' 'libidl2' 'libpng' 'curl')
install=virtualbox-modules.install
source=(http://download.virtualbox.org/virtualbox/$pkgver/VirtualBox-$pkgver-OSE.tar.bz2)
build() {
  cd "$srcdir/VirtualBox-${pkgver}_OSE"
  sed -i 's/python2.5/python2.6/g' configure
  ./configure 

#  sed -i 's/-DVBOX_WITH_HARDENING//' src/VBox/HostDrivers/Support/linux/Makefile

  source ./env.sh
  kmk all || return 1
  
  cd out/linux.x86/release/bin/src
  make || return 1
  install -D -m644 vboxdrv.ko "$pkgdir/lib/modules/${_kernver}/misc/vboxdrv.ko"
  install -D -m644 vboxnetflt.ko "$pkgdir/lib/modules/${_kernver}/misc/vboxnetflt.ko"
  install -D -m644 vboxnetadp.ko "$pkgdir/lib/modules/${_kernver}/misc/vboxnetadp.ko"
  sed -i -e "s/KERNEL_VERSION='.*'/KERNEL_VERSION='${_kernver}'/" "$startdir/virtualbox-modules.install"
}
md5sums=('68e6658b8b11a509d7dec57835cba267')
